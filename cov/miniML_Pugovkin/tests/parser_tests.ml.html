<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>parser_tests.ml &mdash; Coverage report</title>
    <meta name="description" content="100.00% coverage in tests/parser_tests.ml">
    <link rel="stylesheet" href="../coverage.css"/>
    <script src="../highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <div id="header">
      <h1>
        <a href="../index.html">
          <span class="dirname">tests/</span>parser_tests.ml
        </a>
      </h1>
      <h2>100.00%</h2>
    </div>
    <div id="navbar">
    </div>
    <div id="report">
      <div id="lines-layer">
        <pre>
<a id="L1"></a><span > </span>
<a id="L2"></a><span > </span>
<a id="L3"></a><span > </span>
<a id="L4"></a><span > </span>
<a id="L5"></a><span class="visited"> </span>
<a id="L6"></a><span class="visited"> </span>
<a id="L7"></a><span > </span>
<a id="L8"></a><span > </span>
<a id="L9"></a><span > </span>
<a id="L10"></a><span class="visited"> </span>
<a id="L11"></a><span class="visited"> </span>
<a id="L12"></a><span > </span>
<a id="L13"></a><span > </span>
<a id="L14"></a><span > </span>
<a id="L15"></a><span class="visited"> </span>
<a id="L16"></a><span class="visited"> </span>
<a id="L17"></a><span > </span>
<a id="L18"></a><span > </span>
<a id="L19"></a><span > </span>
<a id="L20"></a><span class="visited"> </span>
<a id="L21"></a><span class="visited"> </span>
<a id="L22"></a><span class="visited"> </span>
<a id="L23"></a><span class="visited"> </span>
<a id="L24"></a><span class="visited"> </span>
<a id="L25"></a><span class="visited"> </span>
<a id="L26"></a><span > </span>
<a id="L27"></a><span > </span>
<a id="L28"></a><span > </span>
<a id="L29"></a><span > </span>
<a id="L30"></a><span > </span>
<a id="L31"></a><span > </span>
<a id="L32"></a><span class="visited"> </span>
<a id="L33"></a><span > </span>
<a id="L34"></a><span > </span>
<a id="L35"></a><span > </span>
<a id="L36"></a><span class="visited"> </span>
<a id="L37"></a><span class="visited"> </span>
<a id="L38"></a><span class="visited"> </span>
<a id="L39"></a><span class="visited"> </span>
<a id="L40"></a><span > </span>
<a id="L41"></a><span > </span>
<a id="L42"></a><span > </span>
<a id="L43"></a><span > </span>
<a id="L44"></a><span class="visited"> </span>
<a id="L45"></a><span > </span>
<a id="L46"></a><span > </span>
<a id="L47"></a><span > </span>
<a id="L48"></a><span class="visited"> </span>
<a id="L49"></a><span class="visited"> </span>
<a id="L50"></a><span class="visited"> </span>
<a id="L51"></a><span class="visited"> </span>
<a id="L52"></a><span > </span>
<a id="L53"></a><span > </span>
<a id="L54"></a><span > </span>
<a id="L55"></a><span > </span>
<a id="L56"></a><span > </span>
<a id="L57"></a><span class="visited"> </span>
<a id="L58"></a><span > </span>
<a id="L59"></a><span > </span>
<a id="L60"></a><span > </span>
<a id="L61"></a><span class="visited"> </span>
<a id="L62"></a><span class="visited"> </span>
<a id="L63"></a><span class="visited"> </span>
<a id="L64"></a><span class="visited"> </span>
<a id="L65"></a><span class="visited"> </span>
<a id="L66"></a><span > </span>
<a id="L67"></a><span > </span>
<a id="L68"></a><span > </span>
<a id="L69"></a><span > </span>
<a id="L70"></a><span > </span>
<a id="L71"></a><span > </span>
<a id="L72"></a><span > </span>
<a id="L73"></a><span > </span>
<a id="L74"></a><span > </span>
<a id="L75"></a><span > </span>
<a id="L76"></a><span > </span>
<a id="L77"></a><span > </span>
<a id="L78"></a><span class="visited"> </span>
<a id="L79"></a><span > </span>
<a id="L80"></a><span > </span>
<a id="L81"></a><span > </span>
<a id="L82"></a><span class="visited"> </span>
<a id="L83"></a><span class="visited"> </span>
<a id="L84"></a><span class="visited"> </span>
<a id="L85"></a><span class="visited"> </span>
<a id="L86"></a><span class="visited"> </span>
<a id="L87"></a><span class="visited"> </span>
<a id="L88"></a><span class="visited"> </span>
<a id="L89"></a><span > </span>
<a id="L90"></a><span > </span>
<a id="L91"></a><span > </span>
<a id="L92"></a><span > </span>
<a id="L93"></a><span > </span>
<a id="L94"></a><span > </span>
<a id="L95"></a><span > </span>
<a id="L96"></a><span class="visited"> </span>
<a id="L97"></a><span > </span>
<a id="L98"></a><span > </span>
<a id="L99"></a><span > </span>
<a id="L100"></a><span class="visited"> </span>
<a id="L101"></a><span class="visited"> </span>
<a id="L102"></a><span class="visited"> </span>
<a id="L103"></a><span > </span>
<a id="L104"></a><span > </span>
<a id="L105"></a><span > </span>
<a id="L106"></a><span > </span>
<a id="L107"></a><span class="visited"> </span>
<a id="L108"></a><span > </span>
<a id="L109"></a><span > </span>
<a id="L110"></a><span > </span>
<a id="L111"></a><span class="visited"> </span>
<a id="L112"></a><span class="visited"> </span>
<a id="L113"></a><span class="visited"> </span>
<a id="L114"></a><span > </span>
<a id="L115"></a><span > </span>
<a id="L116"></a><span > </span>
<a id="L117"></a><span class="visited"> </span>
<a id="L118"></a><span > </span>
<a id="L119"></a><span > </span>
<a id="L120"></a><span > </span>
<a id="L121"></a><span class="visited"> </span>
<a id="L122"></a><span class="visited"> </span>
<a id="L123"></a><span class="visited"> </span>
<a id="L124"></a><span class="visited"> </span>
<a id="L125"></a><span > </span>
<a id="L126"></a><span > </span>
<a id="L127"></a><span > </span>
<a id="L128"></a><span > </span>
<a id="L129"></a><span > </span>
<a id="L130"></a><span > </span>
<a id="L131"></a><span class="visited"> </span>
<a id="L132"></a><span > </span>
<a id="L133"></a><span > </span>
<a id="L134"></a><span > </span>
<a id="L135"></a><span class="visited"> </span>
<a id="L136"></a><span class="visited"> </span>
<a id="L137"></a><span class="visited"> </span>
<a id="L138"></a><span > </span>
<a id="L139"></a><span > </span>
<a id="L140"></a><span > </span>
<a id="L141"></a><span class="visited"> </span>
<a id="L142"></a><span > </span>
<a id="L143"></a><span > </span>
<a id="L144"></a><span > </span>
<a id="L145"></a><span class="visited"> </span>
<a id="L146"></a><span class="visited"> </span>
<a id="L147"></a><span > </span>
<a id="L148"></a><span class="visited"> </span>
<a id="L149"></a><span > </span>
<a id="L150"></a><span > </span>
<a id="L151"></a><span > </span>
<a id="L152"></a><span class="visited"> </span>
<a id="L153"></a><span class="visited"> </span>
<a id="L154"></a><span class="visited"> </span>
<a id="L155"></a><span class="visited"> </span>
<a id="L156"></a><span > </span>
<a id="L157"></a><span > </span>
<a id="L158"></a><span > </span>
<a id="L159"></a><span > </span>
<a id="L160"></a><span class="visited"> </span>
<a id="L161"></a><span > </span>
<a id="L162"></a><span > </span>
<a id="L163"></a><span > </span>
<a id="L164"></a><span class="visited"> </span>
<a id="L165"></a><span class="visited"> </span>
<a id="L166"></a><span > </span>
<a id="L167"></a><span > </span>
<a id="L168"></a><span > </span>
<a id="L169"></a><span class="visited"> </span>
<a id="L170"></a><span > </span>
<a id="L171"></a><span > </span>
<a id="L172"></a><span > </span>
<a id="L173"></a><span class="visited"> </span>
<a id="L174"></a><span class="visited"> </span>
<a id="L175"></a><span > </span>
<a id="L176"></a><span > </span>
<a id="L177"></a><span > </span>
<a id="L178"></a><span class="visited"> </span>
<a id="L179"></a><span class="visited"> </span>
<a id="L180"></a><span class="visited"> </span>
<a id="L181"></a><span class="visited"> </span>
<a id="L182"></a><span > </span>
<a id="L183"></a><span > </span>
<a id="L184"></a><span > </span>
<a id="L185"></a><span > </span>
<a id="L186"></a><span class="visited"> </span>
<a id="L187"></a><span > </span>
</pre>
      </div>
      <div id="text-layer">
        <pre id="line-numbers">
<a href="#L1">  1</a>
<a href="#L2">  2</a>
<a href="#L3">  3</a>
<a href="#L4">  4</a>
<a href="#L5">  5</a>
<a href="#L6">  6</a>
<a href="#L7">  7</a>
<a href="#L8">  8</a>
<a href="#L9">  9</a>
<a href="#L10"> 10</a>
<a href="#L11"> 11</a>
<a href="#L12"> 12</a>
<a href="#L13"> 13</a>
<a href="#L14"> 14</a>
<a href="#L15"> 15</a>
<a href="#L16"> 16</a>
<a href="#L17"> 17</a>
<a href="#L18"> 18</a>
<a href="#L19"> 19</a>
<a href="#L20"> 20</a>
<a href="#L21"> 21</a>
<a href="#L22"> 22</a>
<a href="#L23"> 23</a>
<a href="#L24"> 24</a>
<a href="#L25"> 25</a>
<a href="#L26"> 26</a>
<a href="#L27"> 27</a>
<a href="#L28"> 28</a>
<a href="#L29"> 29</a>
<a href="#L30"> 30</a>
<a href="#L31"> 31</a>
<a href="#L32"> 32</a>
<a href="#L33"> 33</a>
<a href="#L34"> 34</a>
<a href="#L35"> 35</a>
<a href="#L36"> 36</a>
<a href="#L37"> 37</a>
<a href="#L38"> 38</a>
<a href="#L39"> 39</a>
<a href="#L40"> 40</a>
<a href="#L41"> 41</a>
<a href="#L42"> 42</a>
<a href="#L43"> 43</a>
<a href="#L44"> 44</a>
<a href="#L45"> 45</a>
<a href="#L46"> 46</a>
<a href="#L47"> 47</a>
<a href="#L48"> 48</a>
<a href="#L49"> 49</a>
<a href="#L50"> 50</a>
<a href="#L51"> 51</a>
<a href="#L52"> 52</a>
<a href="#L53"> 53</a>
<a href="#L54"> 54</a>
<a href="#L55"> 55</a>
<a href="#L56"> 56</a>
<a href="#L57"> 57</a>
<a href="#L58"> 58</a>
<a href="#L59"> 59</a>
<a href="#L60"> 60</a>
<a href="#L61"> 61</a>
<a href="#L62"> 62</a>
<a href="#L63"> 63</a>
<a href="#L64"> 64</a>
<a href="#L65"> 65</a>
<a href="#L66"> 66</a>
<a href="#L67"> 67</a>
<a href="#L68"> 68</a>
<a href="#L69"> 69</a>
<a href="#L70"> 70</a>
<a href="#L71"> 71</a>
<a href="#L72"> 72</a>
<a href="#L73"> 73</a>
<a href="#L74"> 74</a>
<a href="#L75"> 75</a>
<a href="#L76"> 76</a>
<a href="#L77"> 77</a>
<a href="#L78"> 78</a>
<a href="#L79"> 79</a>
<a href="#L80"> 80</a>
<a href="#L81"> 81</a>
<a href="#L82"> 82</a>
<a href="#L83"> 83</a>
<a href="#L84"> 84</a>
<a href="#L85"> 85</a>
<a href="#L86"> 86</a>
<a href="#L87"> 87</a>
<a href="#L88"> 88</a>
<a href="#L89"> 89</a>
<a href="#L90"> 90</a>
<a href="#L91"> 91</a>
<a href="#L92"> 92</a>
<a href="#L93"> 93</a>
<a href="#L94"> 94</a>
<a href="#L95"> 95</a>
<a href="#L96"> 96</a>
<a href="#L97"> 97</a>
<a href="#L98"> 98</a>
<a href="#L99"> 99</a>
<a href="#L100">100</a>
<a href="#L101">101</a>
<a href="#L102">102</a>
<a href="#L103">103</a>
<a href="#L104">104</a>
<a href="#L105">105</a>
<a href="#L106">106</a>
<a href="#L107">107</a>
<a href="#L108">108</a>
<a href="#L109">109</a>
<a href="#L110">110</a>
<a href="#L111">111</a>
<a href="#L112">112</a>
<a href="#L113">113</a>
<a href="#L114">114</a>
<a href="#L115">115</a>
<a href="#L116">116</a>
<a href="#L117">117</a>
<a href="#L118">118</a>
<a href="#L119">119</a>
<a href="#L120">120</a>
<a href="#L121">121</a>
<a href="#L122">122</a>
<a href="#L123">123</a>
<a href="#L124">124</a>
<a href="#L125">125</a>
<a href="#L126">126</a>
<a href="#L127">127</a>
<a href="#L128">128</a>
<a href="#L129">129</a>
<a href="#L130">130</a>
<a href="#L131">131</a>
<a href="#L132">132</a>
<a href="#L133">133</a>
<a href="#L134">134</a>
<a href="#L135">135</a>
<a href="#L136">136</a>
<a href="#L137">137</a>
<a href="#L138">138</a>
<a href="#L139">139</a>
<a href="#L140">140</a>
<a href="#L141">141</a>
<a href="#L142">142</a>
<a href="#L143">143</a>
<a href="#L144">144</a>
<a href="#L145">145</a>
<a href="#L146">146</a>
<a href="#L147">147</a>
<a href="#L148">148</a>
<a href="#L149">149</a>
<a href="#L150">150</a>
<a href="#L151">151</a>
<a href="#L152">152</a>
<a href="#L153">153</a>
<a href="#L154">154</a>
<a href="#L155">155</a>
<a href="#L156">156</a>
<a href="#L157">157</a>
<a href="#L158">158</a>
<a href="#L159">159</a>
<a href="#L160">160</a>
<a href="#L161">161</a>
<a href="#L162">162</a>
<a href="#L163">163</a>
<a href="#L164">164</a>
<a href="#L165">165</a>
<a href="#L166">166</a>
<a href="#L167">167</a>
<a href="#L168">168</a>
<a href="#L169">169</a>
<a href="#L170">170</a>
<a href="#L171">171</a>
<a href="#L172">172</a>
<a href="#L173">173</a>
<a href="#L174">174</a>
<a href="#L175">175</a>
<a href="#L176">176</a>
<a href="#L177">177</a>
<a href="#L178">178</a>
<a href="#L179">179</a>
<a href="#L180">180</a>
<a href="#L181">181</a>
<a href="#L182">182</a>
<a href="#L183">183</a>
<a href="#L184">184</a>
<a href="#L185">185</a>
<a href="#L186">186</a>
<a href="#L187">187</a>
</pre>
<pre><code class="ocaml">open Lambda_lib

(* Утилиты печати через deriving-show *)
let pp_expr s =
  <span data-count="33">t</span>ry Parser.expr_of_string s |&gt; <span data-count="32">A</span>st.show_expr |&gt; <span data-count="32">p</span>rint_endlin<span data-count="32">e</span> with
  | <span data-count="1">P</span>arser.Error msg -&gt; Printf.printf "Error: %s\n" msg
;;

let pp_top s =
  <span data-count="4">t</span>ry Parser.toplevel_of_string s |&gt; <span data-count="3">A</span>st.show_toplevel |&gt; <span data-count="3">p</span>rint_endlin<span data-count="3">e</span> with
  | <span data-count="1">P</span>arser.Error msg -&gt; Printf.printf "Error: %s\n" msg
;;

let pp_prog s =
  <span data-count="2">t</span>ry Parser.program_of_string s |&gt; <span data-count="1">A</span>st.show_program |&gt; <span data-count="1">p</span>rint_endlin<span data-count="1">e</span> with
  | <span data-count="1">P</span>arser.Error msg -&gt; Printf.printf "Error: %s\n" msg
;;

let%expect_test "literals &amp; vars" =
  <span data-count="1">p</span>p_expr "42";
  <span data-count="1">p</span>p_expr "true";
  <span data-count="1">p</span>p_expr "false";
  <span data-count="1">p</span>p_expr "()";
  <span data-count="1">p</span>p_expr "x";
  <span data-count="1">[</span>%expect
    {|
    (Const (Int 42))
    (Const (Bool true))
    (Const (Bool false))
    (Const (Unit ()))
    (Var "x")
  |}<span data-count="7">]</span>
;;

let%expect_test "unary operators" =
  <span data-count="1">p</span>p_expr "-x";
  <span data-count="1">p</span>p_expr "+x";
  <span data-count="1">p</span>p_expr "not x";
  <span data-count="1">[</span>%expect
    {|
    (Unop (UMinus, (Var "x")))
    (Unop (UPlus, (Var "x")))
    (Unop (Not, (Var "x")))
  |}<span data-count="7">]</span>
;;

let%expect_test "application &amp; precedence with unary" =
  <span data-count="1">p</span>p_expr "f x y";
  <span data-count="1">p</span>p_expr "f (g 1) 2";
  <span data-count="1">p</span>p_expr "-f x";
  <span data-count="1">[</span>%expect
    {|
    (App ((App ((Var "f"), (Var "x"))), (Var "y")))
    (App ((App ((Var "f"), (App ((Var "g"), (Const (Int 1)))))), (Const (Int 2))
       ))
    (Unop (UMinus, (App ((Var "f"), (Var "x")))))
  |}<span data-count="7">]</span>
;;

let%expect_test "arithmetic binops" =
  <span data-count="1">p</span>p_expr "1 + 2 * 3";
  <span data-count="1">p</span>p_expr "(1 + 2) * 3";
  <span data-count="1">p</span>p_expr "4 - 5 - 6";
  <span data-count="1">p</span>p_expr "8 / 2 / 2";
  <span data-count="1">[</span>%expect
    {|
    (BinopArithmetic (Add, (Const (Int 1)),
       (BinopArithmetic (Mul, (Const (Int 2)), (Const (Int 3))))))
    (BinopArithmetic (Mul,
       (BinopArithmetic (Add, (Const (Int 1)), (Const (Int 2)))), (Const (Int 3))
       ))
    (BinopArithmetic (Sub,
       (BinopArithmetic (Sub, (Const (Int 4)), (Const (Int 5)))), (Const (Int 6))
       ))
    (BinopArithmetic (Div,
       (BinopArithmetic (Div, (Const (Int 8)), (Const (Int 2)))), (Const (Int 2))
       ))
  |}<span data-count="7">]</span>
;;

let%expect_test "comparisons" =
  <span data-count="1">p</span>p_expr "a = b";
  <span data-count="1">p</span>p_expr "a &lt;&gt; b";
  <span data-count="1">p</span>p_expr "a &lt; b";
  <span data-count="1">p</span>p_expr "a &lt;= b";
  <span data-count="1">p</span>p_expr "a &gt; b";
  <span data-count="1">p</span>p_expr "a &gt;= b";
  <span data-count="1">[</span>%expect
    {|
    (BinopComp (Eq, (Var "a"), (Var "b")))
    (BinopComp (Neq, (Var "a"), (Var "b")))
    (BinopComp (Lt, (Var "a"), (Var "b")))
    (BinopComp (Le, (Var "a"), (Var "b")))
    (BinopComp (Gt, (Var "a"), (Var "b")))
    (BinopComp (Ge, (Var "a"), (Var "b")))
  |}<span data-count="7">]</span>
;;

let%expect_test "boolean operators" =
  <span data-count="1">p</span>p_expr "true &amp;&amp; false";
  <span data-count="1">p</span>p_expr "true || false &amp;&amp; true";
  <span data-count="1">[</span>%expect
    {|
    (BinopBool (And, (Const (Bool true)), (Const (Bool false))))
    (BinopBool (Or, (Const (Bool true)),
       (BinopBool (And, (Const (Bool false)), (Const (Bool true))))))
  |}<span data-count="7">]</span>
;;

let%expect_test "if-then[-else]" =
  <span data-count="1">p</span>p_expr "if x then y else z";
  <span data-count="1">p</span>p_expr "if t then u";
  <span data-count="1">[</span>%expect
    {|
    (If ((Var "x"), (Var "y"), (Some (Var "z"))))
    (If ((Var "t"), (Var "u"), None))
  |}<span data-count="7">]</span>
;;

let%expect_test "lambdas and let-desugaring" =
  <span data-count="1">p</span>p_expr "fun x -&gt; x";
  <span data-count="1">p</span>p_expr "fun x y -&gt; x y";
  <span data-count="1">p</span>p_expr "let rec f x y = x + y in f 1 2";
  <span data-count="1">[</span>%expect
    {|
    (Lam ("x", (Var "x")))
    (Lam ("x", (Lam ("y", (App ((Var "x"), (Var "y")))))))
    (Let (Rec, "f",
       (Lam ("x", (Lam ("y", (BinopArithmetic (Add, (Var "x"), (Var "y"))))))),
       (App ((App ((Var "f"), (Const (Int 1)))), (Const (Int 2))))))
  |}<span data-count="7">]</span>
;;

let%expect_test "let-in (nonrec/rec)" =
  <span data-count="1">p</span>p_expr "let x = 1 in x";
  <span data-count="1">p</span>p_expr "let rec f x = x in f 1";
  <span data-count="1">[</span>%expect
    {|
    (Let (Nonrec, "x", (Const (Int 1)), (Var "x")))
    (Let (Rec, "f", (Lam ("x", (Var "x"))), (App ((Var "f"), (Const (Int 1))))))
  |}<span data-count="7">]</span>
;;

let%expect_test "comments (nested)" =
  <span data-count="1">p</span>p_expr "(* nested *) 1 (* a (* b *) c *) + 2";
  <span data-count="1">[</span>%expect {|
    (BinopArithmetic (Add, (Const (Int 1)), (Const (Int 2))))
  |}<span data-count="7">]</span>
;;

let%expect_test "toplevel items" =
  <span data-count="1">p</span>p_top "x + 1";
  <span data-count="1">p</span>p_top "let x = 1";
  <span data-count="1">p</span>p_top "let rec f x = x";
  <span data-count="1">[</span>%expect
    {|
    (TExpr (BinopArithmetic (Add, (Var "x"), (Const (Int 1)))))
    (TLet (Nonrec, "x", (Const (Int 1))))
    (TLet (Rec, "f", (Lam ("x", (Var "x")))))
  |}<span data-count="7">]</span>
;;

let%expect_test "program" =
  <span data-count="1">p</span>p_prog "let x = 1;; x + 2";
  <span data-count="1">[</span>%expect
    {|
    [(TLet (Nonrec, "x", (Const (Int 1))));
      (TExpr (BinopArithmetic (Add, (Var "x"), (Const (Int 2)))))]
  |}<span data-count="7">]</span>
;;

let%expect_test "fix" =
  <span data-count="1">p</span>p_expr "fix (fun f -&gt; fun x -&gt; f x)";
  <span data-count="1">[</span>%expect {| (Fix (Lam ("f", (Lam ("x", (App ((Var "f"), (Var "x")))))))) |}<span data-count="7">]</span>
;;

let%expect_test "parse errors" =
  <span data-count="1">p</span>p_expr "let";
  <span data-count="1">p</span>p_top "let rec";
  <span data-count="1">p</span>p_prog "let x =";
  <span data-count="1">[</span>%expect
    {|
    Error: : no more choices
    Error: : not enough input
    Error: : end_of_input
  |}<span data-count="7">]</span>
;;
</code></pre>
      </div>
    </div>
    <script src="../coverage.js"></script>
  </body>
</html>
